<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="https://asaicraft.github.io/PropertyBitPack/" />
    <link rel="icon" type="image/svg" href="img/logo.svg">
    <title>Architecture</title>
    <script>
    if (location.search === "?dark") localStorage.setItem('color-scheme','dark') 
    if (location.search === "?light") localStorage.removeItem('color-scheme') 
    const cls = document.querySelector('html').classList
    if (localStorage.getItem('color-scheme') === 'dark')
        cls.add('dark')
    else
        cls.remove('dark')
    </script>
    <link rel="stylesheet" href="css/app.css">
    <script type="importmap">
{
    "imports": {
        "app.mjs": "/PropertyBitPack/mjs/app.mjs",
        "vue": "/PropertyBitPack/lib/mjs/vue.min.mjs",
        "@servicestack/client": "/PropertyBitPack/lib/mjs/servicestack-client.min.mjs",
        "@servicestack/vue": "/PropertyBitPack/lib/mjs/servicestack-vue.min.mjs"
    }
}
</script>
</head>
<body class="bg-white dark:bg-black dark:text-white">
<header id="header" class="top-0 fixed z-50 h-14 bg-white dark:bg-black opacity-90 w-full shadow">
  <nav class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-black">
    <div class="mx-auto max-w-[100rem] pr-4 sm:pr-6 lg:pr-8">
      <div class="flex h-16 justify-between">
        <div class="flex">
          <div class="flex flex-shrink-0 items-center">
            <a class="mr-2 lg:mr-8 flex items-center" href="">
                <svg class="w-8 h-8 mr-1 ml-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0M3 6v13m9-13v13m9-13v13"/></svg>
                <span class="hidden sm:block text-2xl font-semibold">PropertyBitPack Docs</span>
            </a>
          </div>
            <div class="hidden sm:-my-px sm:ml-6 sm:flex sm:space-x-4 lg:space-x-8">
                <!-- Current: "border-indigo-500 text-gray-900", Default: "border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700" -->
                        <a href="to_developers/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            To developers
                        </a>
                        <a href="tode/" class="inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-200">
                            Vue
                        </a>
            </div>
        </div>
        <div class="hidden sm:ml-6 sm:flex sm:items-center">
            <dark-mode-toggle class="ml-2 w-10"></dark-mode-toggle>
        </div>
        <div class="-mr-2 flex items-center sm:hidden">
          <!-- Mobile menu button -->
          <button type="button" v-on:click="open=!open" class="inline-flex items-center justify-center rounded-md bg-white dark:bg-black p-2 text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:ring-offset-black" aria-controls="mobile-menu" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <!-- Menu open: "hidden", Menu closed: "block" -->
            <svg :class="['h-6 w-6', open ? 'hidden' : 'block']" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
            <!-- Menu open: "block", Menu closed: "hidden" -->
            <svg :class="['h-6 w-6', open ? 'block' : 'hidden']" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu, show/hide based on menu state. -->
    <div v-cloak v-if="open" class="sm:hidden">
        <div class="space-y-1 pb-3 pt-2">
            <!-- Current: "border-indigo-500 bg-indigo-50 text-indigo-700", Default: "border-transparent text-gray-600 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-800" -->
                    <a href="to_developers/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        To developers
                    </a>
                    <a href="tode/" class="block border-l-4 py-2 pl-3 pr-4 text-base font-medium border-transparent text-gray-600 dark:text-gray-300 hover:border-gray-300 hover:bg-gray-50 dark:hover:bg-gray-900 hover:text-gray-800 dark:hover:text-gray-100">
                        Vue
                    </a>
        </div>
    </div>
  </nav>
</header>

<script type="module">
import { ref } from "vue"
import { mount } from "app.mjs"

const Header = {
    setup() {
        const open = ref(false)
        return { open }
    }
}
mount('#header', Header)
</script>


<div class="min-h-screen">
    <main role="main" class="pt-16 pb-3">
        




<style>
.active {
    color: #0ea5e9 !important;
}
</style>
<link rel="stylesheet" href="css/highlight.css">
<link rel="stylesheet" href="css/typography.css">
<link rel="stylesheet" href="css/lite-yt-embed.css">

<div class="w-full max-w-[100rem] mx-auto">
    <div class="flex flex-wrap">
        <div id="sidebar" class="z-40 inset-0 flex-none bg-white dark:bg-black lg:w-64 xl:w-80">
            <button v-cloak v-on:click="open=true" :class="['text-gray-400 hover:text-gray-500 pt-4 pl-2 absolute transform transition-all duration-200', open ? 'opacity-0 translate-x-56' : 'opacity-100']" title="Open Sidebar">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H10m10 0l-4 4m4-4l-4-4M4 4v16"/></svg>
            </button>
            <div :class="['fixed bg-white dark:bg-black h-screen overflow-y-auto scrolling-touch overflow-hidden shadow lg:shadow-none transform transition-transform duration-200', open ? '' : 'translate-x-[-100%]']">
                <nav class="sidebar lg:w-64 xl:w-80 px-1 pt-6 pb-16 overflow-y-auto font-medium text-sm lg:text-base sm:px-3 xl:px-5" aria-label="Sidebar">
                    <close-button title="Close Sidebar" class="lg:hidden -mr-2" v-on:close="open=false"></close-button>
                                <a href="/to_developers/" class="block flex items-center whitespace-nowrap">
<svg class='h-6 w-6 shrink-0 text-sky-500' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' aria-hidden='true'><path stroke-linecap='round' stroke-linejoin='round' d='M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25'></path></svg>                                    <span class="p-2 pl-3 font-display font-medium text-slate-900 dark:text-white">
To developers                                    </span>
                                </a>
                        <ul role="list" class="mb-6 mt-2 ml-3 space-y-2 border-l-2 border-slate-100 dark:border-slate-800 lg:mt-4 lg:space-y-4 lg:border-slate-200">
                        </ul>
                </nav>
            </div>
        </div>
        <div id="doc" class="mx-auto flex">
            <div class="mt-8 mx-auto prose lg:prose-lg">
                
                    <section class="not-prose mb-16 md:mb-12">
                        <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 dark:text-gray-50 sm:text-5xl md:text-6xl">
                            Architecture
                        </h1>
                    </section>

                <div class="not-prose"></div>

                <div class="content">
                    <h1 id="to-developers">To Developers<a class="header-anchor" href="javascript:;" onclick="location.hash='#to-developers'" aria-label="Permalink">&ZeroWidthSpace;</a></h1>
<p>Below is an overview of the internal architecture of <strong>PropertyBitPack</strong>, focusing on how it processes attributes, aggregates bit-packed properties, and generates source code. This documentation is intended for contributors who want to understand or extend the source generator logic.</p>
<hr />
<h2 id="high-level-architecture">High-Level Architecture<a class="header-anchor" href="javascript:;" onclick="location.hash='#high-level-architecture'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<ol>
<li><p><strong><code>PropertyBitPackGeneratorContext</code></strong> (abstract class)</p>
<ul>
<li>Defines arrays of <strong>parsers</strong> and <strong>generators</strong>:
<ul>
<li><code>AttributeParsers</code> (implementations of <code>IAttributeParser</code>)</li>
<li><code>BitFieldPropertyParsers</code> (implementations of <code>IBitFieldPropertyParser</code>)</li>
<li><code>BitFieldPropertyAggregators</code> (implementations of <code>IBitFieldPropertyAggregator</code>)</li>
<li><code>PropertySyntaxGenerators</code> (implementations of <code>IPropertiesSyntaxGenerator</code>)</li>
</ul>
</li>
<li>Provides methods to:
<ul>
<li>Identify candidate attributes</li>
<li>Parse them into internal <code>BaseBitFieldPropertyInfo</code> representations</li>
<li>Aggregate property info into requests (<code>IGenerateSourceRequest</code>)</li>
<li>Generate final C# source code (<code>FileGeneratorRequest</code>)</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>PropertyBitPackGeneratorContextImplementation</code></strong></p>
<ul>
<li>A sealed nested class that constructs these arrays <strong>without constructor injection</strong> in the typical DI sense.</li>
<li>Instead, after constructing arrays of parsers/generators, the method <code>BindToSelf()</code> iterates over each component.
<ul>
<li>If the component implements <code>IContextBindable</code>, it calls <code>BindContext(this)</code>, providing a direct link to the current context instance.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>PropertyBitPackSourceGenerator : IIncrementalGenerator</code></strong></p>
<ul>
<li>Holds a static instance of <code>PropertyBitPackGeneratorContext</code>.</li>
<li>Uses <strong>incremental generation</strong>:
<ul>
<li>Filters candidate properties via <code>IsCandidateProperty(...)</code>.</li>
<li>For each property, attempts to parse attached attributes.</li>
<li>Aggregates bit-packed properties.</li>
<li>Calls context methods to generate final source code.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Parsing Workflow</strong></p>
<ol>
<li><strong>Identify</strong> partial properties with certain attributes.</li>
<li><strong>Check</strong> if any of the known attribute parsers (<code>IAttributeParser</code>) match.</li>
<li><strong>Parse</strong> them into <code>BaseBitFieldPropertyInfo</code>.</li>
<li><strong>Aggregate</strong> all recognized properties into <code>IGenerateSourceRequest</code> objects.</li>
<li><strong>Generate</strong> the final <code>.cs</code> source files (property implementations) via <code>IPropertiesSyntaxGenerator</code>.</li>
</ol>
</li>
</ol>
<hr />
<h2 id="mermaid-diagram">Mermaid Diagram<a class="header-anchor" href="javascript:;" onclick="location.hash='#mermaid-diagram'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p><img src="docs/diagrams/propertybitpack-diagram.svg" alt="PropertyBitPack Diagram" /></p>
<details>
  <summary>Diagram source</summary>
<pre><code>```mermaid
flowchart LR
    A[IncrementalGenerator] --&gt; B{PropertyBitPackGeneratorContextImplementation}
    B --&gt;|BindToSelf| D[IContextBindable?]
    B --&gt;|AttributeParsers| C[PropertyDeclaration]
    B --&gt;|BitFieldPropertyParsers| E[BaseBitFieldPropertyInfo]
    B --&gt;|BitFieldPropertyAggregators| F[IGenerateSourceRequest]
    B --&gt;|PropertySyntaxGenerators| G[FileGeneratorRequest (CS)]

    C --&gt; E
    E --&gt; F
    F --&gt; G
```
</code></pre>
<details>
<p><strong>Diagram Explanation</strong>:</p>
<ol>
<li><strong>IncrementalGenerator</strong> filters candidate properties.</li>
<li><strong>PropertyBitPackGeneratorContextImplementation</strong>:
<ul>
<li>Holds arrays of parsers/generators.</li>
<li>Calls <code>BindToSelf()</code>, so each component that implements <code>IContextBindable</code> can access the <strong>context</strong>.</li>
</ul>
</li>
<li>The parsers/generators then handle attribute parsing, property analysis, and source code generation.</li>
</ol>
<hr />
<h2 id="notable-classes-interfaces">Notable Classes &amp; Interfaces<a class="header-anchor" href="javascript:;" onclick="location.hash='#notable-classes-interfaces'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<h3 id="propertybitpackgeneratorcontextimplementation"><code>PropertyBitPackGeneratorContextImplementation</code><a class="header-anchor" href="javascript:;" onclick="location.hash='#propertybitpackgeneratorcontextimplementation'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<pre><code class="language-csharp">internal sealed class PropertyBitPackGeneratorContextImplementation : PropertyBitPackGeneratorContext
{
    public PropertyBitPackGeneratorContextImplementation(
        ImmutableArray&lt;IAttributeParser&gt; attributeParsers,
        ImmutableArray&lt;IBitFieldPropertyParser&gt; bitFieldPropertyParsers,
        ImmutableArray&lt;IBitFieldPropertyAggregator&gt; bitFieldPropertyAggregators,
        ImmutableArray&lt;IPropertiesSyntaxGenerator&gt; bitFieldPropertyGenerators
    ) {
        AttributeParsers = attributeParsers;
        BitFieldPropertyParsers = bitFieldPropertyParsers;
        BitFieldPropertyAggregators = bitFieldPropertyAggregators;
        PropertySyntaxGenerators = bitFieldPropertyGenerators;

        // Binds the context to all parsers/generators that require it
        BindToSelf();
    }
    
    internal void BindToSelf()
    {
        // If any component implements IContextBindable, pass it this context
    }
}
</code></pre>
<ul>
<li><strong>No typical DI constructor injection</strong>. The arrays of components are assigned directly, then <code>BindToSelf()</code> ensures each component can hold a reference to the context if needed.</li>
</ul>
<h3 id="icontextbindable"><code>IContextBindable</code><a class="header-anchor" href="javascript:;" onclick="location.hash='#icontextbindable'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<pre><code class="language-csharp">internal interface IContextBindable
{
    void BindContext(PropertyBitPackGeneratorContext context);
}
</code></pre>
<ul>
<li>Components (e.g., parsers, aggregators, syntax generators) implement <code>IContextBindable</code> to gain access to shared context data or services.</li>
</ul>
<h3 id="propertybitpacksourcegenerator"><code>PropertyBitPackSourceGenerator</code><a class="header-anchor" href="javascript:;" onclick="location.hash='#propertybitpacksourcegenerator'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<ul>
<li><strong>Entry point</strong> for incremental generation. Creates a static <code>_context</code> using a <code>PropertyBitPackGeneratorContextBuilder</code>.</li>
<li>Scans the syntax for candidate partial properties, matches attributes, and produces generated <code>.cs</code> files.</li>
</ul>
<hr />
<h2 id="customizing-parsers-generators">Customizing Parsers &amp; Generators<a class="header-anchor" href="javascript:;" onclick="location.hash='#customizing-parsers-generators'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>To add or override behavior:</p>
<ol>
<li><strong>Implement</strong> a new <code>IAttributeParser</code>, <code>IBitFieldPropertyParser</code>, <code>IBitFieldPropertyAggregator</code>, or <code>IPropertiesSyntaxGenerator</code>.</li>
<li><strong>Attach</strong> it to the context builder:
<pre><code class="language-csharp">var builder = PropertyBitPackGeneratorContextBuilder.Create();
builder.AttributeParsers.Add(new MyCustomAttributeParser());
builder.BitFieldPropertyParsers.Add(new MyCustomBitFieldParser());
// ...
var context = builder.Build(); // Returns PropertyBitPackGeneratorContextImplementation
</code></pre>
</li>
<li><strong>Use</strong> <code>BindToSelf()</code> to allow each component to <code>BindContext(...)</code> if it implements <code>IContextBindable</code>.</li>
</ol>
<hr />
<h2 id="summary">Summary<a class="header-anchor" href="javascript:;" onclick="location.hash='#summary'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<ul>
<li><strong>PropertyBitPack</strong> uses a modular approach, allowing you to plug in new attribute parsers, property parsers, aggregators, and syntax generators.</li>
<li><strong>Context binding</strong> is not done through traditional DI constructor injection; instead, <strong><code>BindToSelf()</code></strong> iterates over all registered components and calls <code>BindContext(this)</code> if they implement <code>IContextBindable</code>.</li>
<li>This design keeps the architecture flexible and straightforward, enabling easy extension for advanced bit-packing scenarios.</li>
</ul>
<p>For questions or deeper discussion, feel free to join our <a href="https://discord.gg/RpxD2BeNsZ">Discord</a>!</p>

                </div>

                <div class="not-prose"></div>
                

                    <div class="not-prose my-20">
                    </div>
            </div>
                
                <div class="docmap hidden 2xl:block flex-none w-64 pl-8 mr-8">
                    <div class="fixed bg-white dark:bg-black flex flex-col overflow-y-auto pt-10 px-8 pb-6" style="height:calc(100vh - 50px);">
                        <div>
                            <h5 class="text-slate-900 font-semibold mb-4 text-sm leading-6 dark:text-slate-100">
                                On This Page
                            </h5>
                            <ul class="text-slate-700 text-sm leading-6">
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#high-level-architecture'" data-id="high-level-architecture" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            High-Level Architecture
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#mermaid-diagram'" data-id="mermaid-diagram" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Mermaid Diagram
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#notable-classes-interfaces'" data-id="notable-classes-interfaces" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Notable Classes &amp; Interfaces
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#customizing-parsers-generators'" data-id="customizing-parsers-generators" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Customizing Parsers &amp; Generators
                                        </span>
                                    </li>
                                    <li class="group text-gray-800 hover:text-gray-900">
                                        <span v-hash="'#summary'" data-id="summary" class="cursor-pointer font-medium block text-sm transform transition-colors duration-200 py-2">
                                            Summary
                                        </span>
                                    </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
        </div>
    </div>    
</div>

<script>
//doc instructions
if (document.querySelector('.hide-title')) {
    const el = document.querySelector('#doc section h1') 
    if (el) el.style.display='none'
}
</script>

<script type="module">
import { ref } from "vue"
import { mount } from "app.mjs"


    const App = {
        setup() {
            function nav(url) {
                window.open(url)
            }
            return { nav }
        }
    }
    
const Sidebar = {
    setup() {
        const open = ref(true)
        return { open }
    }
}

mount('#doc', App)
mount('#sidebar', Sidebar)
</script>

<script src="lib/js/highlight.js"></script>
<script>hljs.highlightAll()</script>
<script src="lib/js/lite-yt-embed.js"></script>
<script src="mjs/docs.mjs" type="module"></script>

    </main>
</div>



<script type="module">
import { init } from "app.mjs"
init()
</script>



</body>
</html>